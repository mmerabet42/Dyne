NAME		=	libdn.a
CC			=	g++ -std=c++17
CFLAGS		=	-Wall -Wextra -Werror -g3 -fsanitize=address

GET_PACKAGE	=	`pkg-config --static --libs glfw3 openal sndfile`

MAIN_FILE	= main.cpp
OUT			= a.out

INCLUDE_FLG	= -I ~/.brew/include -I include/

OSNAME		= $(shell uname -s)
ifeq ($(OSNAME),Linux)
	COMPILE	= $(CC) $(MAIN_FILE) $(NAME) $(GET_PACKAGE) -ldl $(INCLUDE_FLG) -o $(OUT) -g3 -fsanitize=address
endif
ifeq ($(OSNAME),Darwin)
	COMPILE = $(CC) $(MAIN_FILE) $(NAME) $(GET_PACKAGE) -framework OpenGL -framework OpenAL $(INCLUDE_FLG) -o $(OUT)# -g3 -fsanitize=address
endif

SRCD		= src/
INCLUDES_D	= include/
_INCLUDES	= #eng.hpp Window.hpp Application.hpp Color.hpp Funcs.hpp Event.hpp Object.hpp \
			  #Shader.hpp Vertex.hpp Model.hpp Component.hpp Transform.hpp MeshRenderer.hpp \
			  #Prototype.hpp Camera.hpp stb_image.h Codes.hpp ApplicationDependent.hpp \
			  #Audio.hpp AudioSource.hpp AudioListener.hpp utils.hpp Scene.hpp \
			  #ModelInstance.hpp KeyCode.hpp

_MAIN_FS	=
_APP_FS		= Application.cpp Callbacks.cpp Init.cpp \
			  WindowManagement.cpp DependentsManagement.cpp ApplicationDependent.cpp
_WIN_FS		= Window.cpp Window2.cpp CallbackSetters.cpp
_SHDR_FS	= Shader.cpp DefaultShader.cpp
_MESH_FS	= Model.cpp Models.cpp
_MATH_FS	= SmoothDamp.cpp Random.cpp
_OBJ_FS		= Object.cpp UComponent.cpp Component.cpp \
			  Transform.cpp Camera.cpp Mesh.cpp 
_TXTR_FS	= Texture.cpp
_AUDIO_FS	= Audio.cpp AudioSource.cpp AudioListener.cpp
_UTILS_FS	= Utils.cpp
_SCENE_FS	= Scene.cpp ModelInstance.cpp
_SYSTEM_FS	= Engine.cpp RenderEngine.cpp
_GLAD_FS	= glad.c

INCLUDES	= $(addprefix $(INCLUDES_D),$(_INCLUDES))

MAIN_FS		= $(addprefix $(SRCD)main/,$(_MAIN_FS))
MAIN_O		= $(_MAIN_FS:.cpp=.o)
APP_FS		= $(addprefix $(SRCD)Application/,$(_APP_FS))
APP_O		= $(_APP_FS:.cpp=.o)
WIN_FS		= $(addprefix $(SRCD)Window/,$(_WIN_FS))
WIN_O		= $(_WIN_FS:.cpp=.o)
SHDR_FS		= $(addprefix $(SRCD)Shader/,$(_SHDR_FS))
SHDR_O		= $(_SHDR_FS:.cpp=.o)
MESH_FS		= $(addprefix $(SRCD)Model/,$(_MESH_FS))
MESH_O		= $(_MESH_FS:.cpp=.o)
MATH_FS		= $(addprefix $(SRCD)Math/,$(_MATH_FS))
MATH_O		= $(_MATH_FS:.cpp=.o)
OBJ_FS		= $(addprefix $(SRCD)Object/,$(_OBJ_FS))
OBJ_O		= $(_OBJ_FS:.cpp=.o)
TXTR_FS		= $(addprefix $(SRCD)Texture/,$(_TXTR_FS))
TXTR_O		= $(_TXTR_FS:.cpp=.o)
AUDIO_FS	= $(addprefix $(SRCD)Audio/,$(_AUDIO_FS))
AUDIO_O		= $(_AUDIO_FS:.cpp=.o)
UTILS_FS	= $(addprefix $(SRCD)Utils/,$(_UTILS_FS))
UTILS_O		= $(_UTILS_FS:.cpp=.o)
SCENE_FS	= $(addprefix $(SRCD)Scene/,$(_SCENE_FS))
SCENE_O		= $(_SCENE_FS:.cpp=.o)
SYSTEM_FS	= $(addprefix $(SRCD)Engine/,$(_SYSTEM_FS))
SYSTEM_O	= $(_SYSTEM_FS:.cpp=.o)
GLAD_FS		= $(addprefix $(SRCD)glad/,$(_GLAD_FS))
GLAD_O		= $(_GLAD_FS:.c=.o)

SRCS		= $(MAIN_FS) $(APP_FS) $(WIN_FS) $(SHDR_FS) $(MESH_FS) $(MATH_FS) \
			  $(OBJ_FS) $(TXTR_FS) $(AUDIO_FS) $(UTILS_FS) $(SCENE_FS) $(SYSTEM_FS) $(GLAD_FS)
OBJS		= $(MAIN_O) $(APP_O) $(WIN_O) $(SHDR_O) $(MESH_O) $(MATH_O) $(SYSTEM_O) \
			  $(OBJ_O) $(TXTR_O) $(AUDIO_O) $(UTILS_O) $(SCENE_O) $(GLAD_O)
OBJD		= .objs/
OBJB		= $(addprefix $(OBJD),$(OBJS))

# COLORS
CRED=\033[91m
CGREEN=\033[38;2;0;255;145m
CEND=\033[0m
all: $(NAME)

$(NAME): $(OBJB)
	@printf "\r\033[K$(CGREEN)Creating$(CEND): $(NAME)\n"
	@ar rc $(NAME) $(OBJB)
	@ranlib $(NAME)
	@echo  "$(NAME): $(CGREEN)done$(CEND)"

$(OBJD)%.o: $(SRCD)main/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Application/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Window/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Shader/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Model/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Math/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Object/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Texture/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Audio/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Utils/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Scene/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)Engine/%.cpp $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

$(OBJD)%.o: $(SRCD)glad/%.c $(INCLUDES)# Makefile
	@printf "\r\033[K$(CGREEN)Compiling$(CEND): $<"
	@mkdir -p $(OBJD)
	@$(CC) $(CLFAGS) -o $@ -c $< $(INCLUDE_FLG)

clean:
	@echo "$(CRED)Cleaning$(CEND): $(NAME)"
	@rm -rf $(OBJD)
	@rm -f $(NAME)

fclean:
	@make clean

re:
	@make clean
	@make all

main:
	make $(NAME)
	$(COMPILE)

#.PHONY: all clean fclean re
